#!/bin/bash
#no no no
case $- in
    *i*) ;;
      *) return;;
esac

# don't put duplicate lines or lines starting with space in the history.
# See bash(1) for more options
HISTCONTROL=ignoredupes
shopt -s cmdhist

# append to the history file, don't overwrite it
shopt -s histappend
export LD_LIBRARY_PATH=$HOME/homebrew/lib:$LD_LIBRARY_PATH
export PATH=$HOME/homebrew/bin:$PATH

# Global
export PATH=$HOME/bin:$PATH
export EDITOR=vi

# Homebrew
export PATH=$HOME/homebrew/bin:$PATH
export HOMEBREW_NO_ANALYTICS=1

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
export HISTSIZE=10000
export HISTFILESIZE=20000

# check the window size after each command and, if necessary,
# update the values of LINES and COLUMNS.
shopt -s checkwinsize
export HISTIGNORE="&:ls:[bf]g:exit"
export CLICOLOR=1
export LSCOLORS=GxFxCxDxBxegedabagaced
#PS1='\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
PS1='wardo:\W$ '

# some more ls aliases
bu () { cp ~/.bash_profile ~/.backup/'bash_profile'-`date +%Y%m%d%H%M`.backup ;  }
alias bashme='vi $HOME/.bash_profile'
alias gonow='bu && bashme'
alias s='source $HOME/.bash_profile'
alias curl="$HOME/homebrew/opt/curl/bin/curl"
alias openssl="$HOME/homebrew/opt/openssl/bin/openssl"

alias ll='ls -alh'                                                     # List files
alias llr='ls -alhr'                                                   # List files (reverse)
alias lls='ls -alhS'                                                   # List files by size
alias llsr='ls -alhSr'                                                 # List files by size (reverse)
alias lld='ls -alht'                                                   # List files by date
alias lldr='ls -alhtr'                                                 # List files by date (reverse)
alias lldc='ls -alhtU'                                                 # List files by date created
alias lldcr='ls -alhtUr'                                               # List files by date created (reverse)
h() { history | grep "$1"; }                                           # Shorthand for `history` with added grepping


# Utilities
alias getsshkey="pbcopy < ~/.ssh/id_rsa.pub"               # Copy SSH key to the keyboard
disk-usage() { du -hs "$@" | sort -nr; }                  # List disk usage of all the files in a directory (use -hr to sort on server)
mktar() { tar cvzf "${1%%/}.tar.gz"  "${1%%/}/"; }    # Creates a *.tar.gz archive of a file or folder
mkzip() { zip -r "${1%%/}.zip" "$1" ; }               # Create a *.zip archive of a file or folder


# Navigation Shortcuts
alias home='clear && cd ~ && ll'                                     # Home directory
alias downloads='clear && cd ~/Downloads && ll'                      # Downloads directory
alias ..='cl ..'
alias ...='cl ../../'
alias ....='cl ../../../'
alias .....='cl ../../../../'
alias ......='cl ../../../../'
alias .......='cl ../../../../../'
alias ........='cl ../../../../../../'


# Directory and file stuff
alias tree="find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'"  # List the file structure of the current directory
dirdiff() { diff -u <( ls "$1" | sort)  <( ls "$2" | sort ); }       # Compare the contents of 2 directories
cs() { cd "$@" &&  ls; }                                             # Enter directory and list contents with ls
cl() { cd "$@" && ll; }                                              # Enter directory and list contents with ll
site() { clear && cl $HOME/sites/"$@"; }                             # Access site folders easier
wp-theme() { clear && cl $HOME/sites/"$@"/content/themes/"$@"; }   # Access a site theme folders easier
project() { clear && cl $HOME/projects/"$@"; }                      # Access project folders easier

alias perm="stat -f '%Lp'"                                             # View the permissions of a file/dir as a number
alias mkdir='mkdir -pv'  


#backup a folder or file
#bu () { cp $1 ~/.backup/`basename $1`-`date +%Y%m%d%H%M`.backup ; }

#unzip anything
extract () {
     if [ -f $1 ] ; then
         case $1 in
             *.tar.bz2)   tar xjf $1        ;;
             *.tar.gz)    tar xzf $1     ;;
             *.bz2)       bunzip2 $1       ;;
             *.rar)       rar x $1     ;;
             *.gz)        gunzip $1     ;;
             *.tar)       tar xf $1        ;;
             *.tbz2)      tar xjf $1      ;;
             *.tgz)       tar xzf $1       ;;
             *.zip)       unzip $1     ;;
             *.Z)         uncompress $1  ;;
             *.7z)        7z x $1    ;;
             *)           echo "'$1' cannot be extracted via extract()" ;;
         esac
     else
         echo "'$1' is not a valid file"
     fi
}

#netinfo - shows network information for your system
netinfo ()
{
echo "--------------- Network Information ---------------"
/sbin/ifconfig | awk /'inet addr/ {print $2}'
/sbin/ifconfig | awk /'Bcast/ {print $3}'
/sbin/ifconfig | awk /'inet addr/ {print $4}'
/sbin/ifconfig | awk /'HWaddr/ {print $4,$5}'
myip=`lynx -dump -hiddenlinks=ignore -nolist http://checkip.dyndns.org:8245/ | sed '/^$/d; s/^[ ]*//g; s/[ ]*$//g' `
echo "${myip}"
echo "---------------------------------------------------"
}

#dirsize - finds directory sizes and lists them for the current directory
dirsize ()
{
du -shx * .[a-zA-Z0-9_]* 2> /dev/null | \
egrep '^ *[0-9.]*[MG]' | sort -n > /tmp/list
egrep '^ *[0-9.]*M' /tmp/list
egrep '^ *[0-9.]*G' /tmp/list
rm -rf /tmp/list
}

#copy and go to dir
cpg (){
  if [ -d "$2" ];then
    cp $1 $2 && cd $2
  else
    cp $1 $2
  fi
}

#move and go to dir
mvg (){
  if [ -d "$2" ];then
    mv $1 $2 && cd $2
  else
    mv $1 $2
  fi
}

psgrep() {
	if [ ! -z $1 ] ; then
		echo "Grepping for processes matching $1..."
		ps aux | grep $1 | grep -v grep
	else
		echo "!! Need name to grep for"
	fi
}
grab() {
	sudo chown -R ${USER} ${1:-.}
}

# Clear a directory
cleardir() {
    while true; do
        read -ep 'Completely clear current directory? [y/N] ' response
        case $response in
            [Yy]* )
                bash -c 'rm -rfv ./*'
                bash -c 'rm -rfv ./.*'
                break;;
            * )
                echo 'Skipped clearing the directory...'
                break;;
        esac
    done
}



# Tell the terminal about the working directory at each prompt.
# Supports opening a new tab or window in the same working directory.
if [ "$TERM_PROGRAM" == "Apple_Terminal" ] && [ -z "$INSIDE_EMACS" ]; then
    update_terminal_cwd() {
        # Identify the directory using a "file:" scheme URL,
        # including the host name to disambiguate local vs.
        # remote connections. Percent-escape spaces.
        local SEARCH=' '
        local REPLACE='%20'
        local PWD_URL="file://$HOSTNAME${PWD//$SEARCH/$REPLACE}"
        printf '\e]7;%s\a' "$PWD_URL"
    }
    PROMPT_COMMAND="update_terminal_cwd; $PROMPT_COMMAND"
fi

# For gcloud to reauth with SK.
# TODO: b/267371979 - remove this once go/gnubby:gcloud-webauthn is launched.
# http://b/34182819
export SK_SIGNING_PLUGIN=gnubbyagent
# http://b/353538084
export GOOGLE_AUTH_WEBAUTHN_PLUGIN=gcloudwebauthn
# Ensure Google3 logs are written to /var/log/google to survive reboots.
#export GOOGLE_LOG_DIR=/var/log/google

# Enable Enterprise Certificate Proxy for gcloud
# http://b/295244316
ECP_CERTIFICATE_CONFIG_FILE_PATH=/etc/certificate_config.json
if groups | grep -q -w ecp-config-deployment ; then
  export CLOUDSDK_CONTEXT_AWARE_CERTIFICATE_CONFIG_FILE_PATH="${ECP_CERTIFICATE_CONFIG_FILE_PATH}"
  export GOOGLE_API_CERTIFICATE_CONFIG="${ECP_CERTIFICATE_CONFIG_FILE_PATH}"
fi
if groups | grep -q -w gcloud-mTLS-deployment ; then
  export CLOUDSDK_CONTEXT_AWARE_USE_CLIENT_CERTIFICATE=true
fi

if [ -d /etc/bash.bashrc.d ]; then
  for i in /etc/bash.bashrc.d/*.sh; do
    if [ -r $i ]; then
      . $i
    fi
  done
  unset i
fi

# Suppress 'default interactive shell is now zsh' message
# http://b/198760462
export BASH_SILENCE_DEPRECATION_WARNING=1



# The next line updates PATH for the Google Cloud SDK.
if [ -f '/Users/stefanward/gcp/gcp/google-cloud-sdk/path.bash.inc' ]; then . '/Users/stefanward/gcp/gcp/google-cloud-sdk/path.bash.inc'; fi

# The next line enables shell command completion for gcloud.
if [ -f '/Users/stefanward/gcp/gcp/google-cloud-sdk/completion.bash.inc' ]; then . '/Users/stefanward/gcp/gcp/google-cloud-sdk/completion.bash.inc'; fi



complete -C /Users/stefanward/homebrew/bin/terraform terraform
