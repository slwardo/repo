# Local changes should be made in $HOME/.bash_profile

if [ -z "$PS1" ]; then
   return
fi

PS1='\h:\W \u\$ '

# Make bash check its window size after a process completes
shopt -s checkwinsize
export LD_LIBRARY_PATH=$HOME/homebrew/lib:$LD_LIBRARY_PATH
export PATH=$HOME/homebrew/bin:$PATH

[ -r "/etc/bashrc_$TERM_PROGRAM" ] && . "/etc/bashrc_$TERM_PROGRAM"

# History settings
HISTSIZE=64000
HISTFILESIZE=64000
# Enable timestamps in bash_history
HISTTIMEFORMAT="[%F %T %z] "
# Stop history being clobbered if there are multiple shells open
shopt -s histappend


alias bashrc='vi ~/.bash_profile'
alias s='source ~/.bash_profile'
alias ll='ls -alh'                                                     # List files
alias llr='ls -alhr'                                                   # List files (reverse)
alias lls='ls -alhS'                                                   # List files by size
alias llsr='ls -alhSr'                                                 # List files by size (reverse)
alias lld='ls -alht'                                                   # List files by date
alias lldr='ls -alhtr'                                                 # List files by date (reverse)
alias lldc='ls -alhtU'                                                 # List files by date created
alias lldcr='ls -alhtUr'                                               # List files by date created (reverse)
h() { history | grep "$1"; }                                           # Shorthand for `history` with added grepping


# Utilities
alias getsshkey="pbcopy < ~/.ssh/id_rsa.pub"               # Copy SSH key to the keyboard
disk-usage() { du -hs "$@" | sort -nr; }                  # List disk usage of all the files in a directory (use -hr to sort on server)
mktar() { tar cvzf "${1%%/}.tar.gz"  "${1%%/}/"; }    # Creates a *.tar.gz archive of a file or folder
mkzip() { zip -r "${1%%/}.zip" "$1" ; }               # Create a *.zip archive of a file or folder


# Navigation Shortcuts
alias home='clear && cd ~ && ll'                                     # Home directory
alias downloads='clear && cd ~/Downloads && ll'                      # Downloads directory
alias ..='cl ..'
alias ...='cl ../../'
alias ....='cl ../../../'
alias .....='cl ../../../../'
alias ......='cl ../../../../'
alias .......='cl ../../../../../'
alias ........='cl ../../../../../../'


# Directory and file stuff
alias tree="find . -print | sed -e 's;[^/]*/;|____;g;s;____|; |;g'"  # List the file structure of the current directory
dirdiff() { diff -u <( ls "$1" | sort)  <( ls "$2" | sort ); }       # Compare the contents of 2 directories
cs() { cd "$@" &&  ls; }                                             # Enter directory and list contents with ls
cl() { cd "$@" && ll; }                                              # Enter directory and list contents with ll
site() { clear && cl $HOME/sites/"$@"; }                             # Access site folders easier
wp-theme() { clear && cl $HOME/sites/"$@"/content/themes/"$@"; }   # Access a site theme folders easier
project() { clear && cl $HOME/projects/"$@"; }                      # Access project folders easier

alias perm="stat -f '%Lp'"                                             # View the permissions of a file/dir as a number
alias mkdir='mkdir -pv'                                                # Make parent directories if needed

# Clear a directory
cleardir() {
    while true; do
        read -ep 'Completely clear current directory? [y/N] ' response
        case $response in
            [Yy]* )
                bash -c 'rm -rfv ./*'
                bash -c 'rm -rfv ./.*'
                break;;
            * )
                echo 'Skipped clearing the directory...'
                break;;
        esac
    done
}







# Tell the terminal about the working directory at each prompt.
# Supports opening a new tab or window in the same working directory.
if [ "$TERM_PROGRAM" == "Apple_Terminal" ] && [ -z "$INSIDE_EMACS" ]; then
    update_terminal_cwd() {
        # Identify the directory using a "file:" scheme URL,
        # including the host name to disambiguate local vs.
        # remote connections. Percent-escape spaces.
        local SEARCH=' '
        local REPLACE='%20'
        local PWD_URL="file://$HOSTNAME${PWD//$SEARCH/$REPLACE}"
        printf '\e]7;%s\a' "$PWD_URL"
    }
    PROMPT_COMMAND="update_terminal_cwd; $PROMPT_COMMAND"
fi

# For gcloud to reauth with SK.
# TODO: b/267371979 - remove this once go/gnubby:gcloud-webauthn is launched.
# http://b/34182819
export SK_SIGNING_PLUGIN=gnubbyagent
# http://b/353538084
export GOOGLE_AUTH_WEBAUTHN_PLUGIN=gcloudwebauthn
# The next line updates PATH for the Google Cloud SDK.
if [ -f '/Users/stefanward/Downloads/google-cloud-sdk/path.bash.inc' ]; then . '/Users/stefanward/Downloads/google-cloud-sdk/path.bash.inc'; fi

# The next line enables shell command completion for gcloud.
if [ -f '/Users/stefanward/Downloads/google-cloud-sdk/completion.bash.inc' ]; then . '/Users/stefanward/Downloads/google-cloud-sdk/completion.bash.inc'; fi

# Ensure Google3 logs are written to /var/log/google to survive reboots.
#export GOOGLE_LOG_DIR=/var/log/google

# Enable Enterprise Certificate Proxy for gcloud
# http://b/295244316
ECP_CERTIFICATE_CONFIG_FILE_PATH=/etc/certificate_config.json
if groups | grep -q -w ecp-config-deployment ; then
  export CLOUDSDK_CONTEXT_AWARE_CERTIFICATE_CONFIG_FILE_PATH="${ECP_CERTIFICATE_CONFIG_FILE_PATH}"
  export GOOGLE_API_CERTIFICATE_CONFIG="${ECP_CERTIFICATE_CONFIG_FILE_PATH}"
fi
if groups | grep -q -w gcloud-mTLS-deployment ; then
  export CLOUDSDK_CONTEXT_AWARE_USE_CLIENT_CERTIFICATE=true
fi

if [ -d /etc/bash.bashrc.d ]; then
  for i in /etc/bash.bashrc.d/*.sh; do
    if [ -r $i ]; then
      . $i
    fi
  done
  unset i
fi

# Suppress 'default interactive shell is now zsh' message
# http://b/198760462
export BASH_SILENCE_DEPRECATION_WARNING=1
